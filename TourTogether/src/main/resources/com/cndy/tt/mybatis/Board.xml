<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.spring.mybatis.BoardDTO">
	
	<resultMap id="addrResult" type="BoardDTO">
        <result property="board_no" column="BOARD_NO"/>
        <result property="email" column="EMAIL"/>
        <result property="title" column="TITLE"/>
        <result property="board_type" column="BOARD_TYPE"/>
        <result property="board_content" column="BOARD_CONTENT"/>
        <result property="start_date" column="START_DATE"/>
        <result property="end_date" column="END_DATE"/>
        <result property="tour_time" column="TOUR_TIME"/>
        <result property="region" column="REGION"/>
        <result property="budget" column="BUDGET"/>
        <result property="company" column="COMPANY"/>
        <result property="write_date" column="WRITE_DATE"/>
        <result property="read_count" column="READ_COUNT"/>
        <result property="photo_path" column="PHOTO_PATH"/>
	</resultMap>
	
	<resultMap id="chatingResult" type="java.util.HashMap">
		<result javaType="String" property="room_num" column="CHATING_ROOM"/>
		<result javaType="String" property="chating_member" column="CHATING_MEMBER1"/>
		<result javaType="String" property="user_member" column="CHATING_MEMBER2"/>
		<result javaType="String" property="chating_content" column="CHATING_CONTENT"/>
	</resultMap>
	
	<select id="boardSelectAll" resultType="BoardDTO">
   		<![CDATA[select * from BOARD where rownum<9 and board_type=10 order by board_no desc]]>
    </select>
	
	<delete id="diaryDelete" parameterType="long">
	   delete from BOARD where BOARD_NO = #{board_no}
	</delete>
	
	<select id="pageSelectAll" resultType="BoardDTO" parameterType="long">
		<![CDATA[select * from (select rownum rn, b.* from BOARD b where rownum<#{page} and board_type=10 order by board_no desc) p where p.rn>=#{page}-9 order by board_no desc]]>
	</select>
	<insert id="boardInsert" parameterType="BoardDTO" useGeneratedKeys="true" keyProperty="board_no">
		<selectKey keyProperty="board_no" resultType="int" order="BEFORE">
			select BOARD_SEQ.nextval from DUAL
		</selectKey>
		insert into Board values(#{board_no},#{email}, #{title}, #{board_type},#{board_content},#{start_date},#{end_date},#{tour_time},#{region},#{budget},#{company},sysdate,'1',#{photo_path})
	</insert>
	<insert id="locationInsert" parameterType="hashmap">
		insert into LOCATION values(#{board_no},#{jb},#{ib})
	</insert>
	<select id="Chating_search" parameterType="hashmap" resultType="int">
		<![CDATA[select nvl(min(chating_room),0) from chating where chating_member1 in (#{chating_member},#{user_member}) and chating_member2 in (#{chating_member},#{user_member})]]>
	</select>
	<select id="Chating_select" parameterType="hashmap" resultMap="chatingResult">
		<![CDATA[select * from chating where chating_member1 in (#{chating_member},#{user_member}) and chating_member2 in (#{chating_member},#{user_member})]]>
	</select>
	<insert id="chating_insert" parameterType="hashmap" useGeneratedKeys="true" keyProperty="chat_no">
		<selectKey keyProperty="chat_no" resultType="String" order="BEFORE">
			select chating_room_seq.nextval from DUAL
		</selectKey>
		insert into CHATING values(#{chat_no},#{chating_member},#{user_member},#{chating_content})
	</insert>
</mapper>